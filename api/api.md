# GIS API

REST API  для взаимодействия FrontEnd (Web-версия и QGIS-версия) с ним.

### Сокращения

`*datatype*` - тип данных, может принимать значения: *boolean*, *int*, *float*, *string*

### Методы

GET /entity - получить описание объекта.

Параметры:
* layer - название слоя (название таблицы слоя, что должно быть одно и то же)
* geom_id - id геометрического объекта 

Ответ:
```json
{
    "layer": "Название_слоя",   //Название слоя
    "geom_id": 1,               //id геометрического объекта
    "attributes": {
        "prop1": ...,               //атрибуты и их значения
        "prop2": ...,
        ...
        "propn": ...
    }
}
```

PUT /entity - изменить описание объекта. Если атрибуты, которых не существуют, должна быть ошибка. Атрибуты, которые существуют в схеме сущности, но не были представлены, должны быть заполнены значениями по умолчанию.

Параметры:
```json
{
    "layer": "Название_слоя", //Название слоя
    "geom_id": 1,             //id объекта
    "attributes": {           //атрибуты и их значения
        "prop1": ...,
        "prop2": ...,
        ....
        "propn": ...
    }
}
```

Ответ: если успешно, то возвращает то же самое

GET /entity_type - получить схему сущности

Параметры:
* layer - название слоя

Ответ:
```json
{
    "layer": "Название_слоя", //Название слоя,
    "name" : "Название_типа сущности",
    "attributes": [           //атрибуты и их типы
       {
            "name": "Название атрибута человеческое",   //название атрибута на человеческом языке 
            "code": "name_of_atribute",                 //Название поля в view слоя, должно удовлетворять валидации названия поля в бд
            "datatype": *datatype*                      //Тип данных
       },
       ...
    ]
}
```

POST /entity_type - создать схему сущности - позволяет создавать атрибуты и пр. для данного слоя. Если схема для слоя уже существует, то нужно только вернуть уже существующую схему.

Параметры:
```json
{
    "layer": "название_слоя",
    "name" : "Название_типа сущности",
    "attributes": [           //атрибуты и их типы
       {
            "name": "Название атрибута человеческое",   //название атрибута на человеческом языке 
            "code": "name_of_atribute",                 //Название поля в view слоя, должно удовлетворять валидации названия поля в бд
            "datatype": *datatype*                      //Тип данных
       },
       ...
    ]
}
```

Ответ:
```json
    {
        "layer" : "название_слоя",
        "name" : "Название_типа сущности",
        "attributes": {           //атрибуты и их типы
            "prop1": *datetype*,
            "prop2": *datetype*,
            ....
            "propn": *datetype*
    }
    }
```

PUT /entity_type - загрузить схему сущности

Параметры:
```json
{
    "layer": "Название_слоя", //Название слоя,
    "name" : "Название_типа сущности",
    "attributes": [           //атрибуты и их типы
       {
            "name": "Название атрибута человеческое",   //название атрибута на человеческом языке 
            "code": "name_of_atribute",                 //Название поля в view слоя, должно удовлетворять валидации названия поля в бд
            "datatype": *datatype*                      //Тип данных
       },
       ...
    ]
}
```

Ответ: если успешно, то возвращает то же самое

DELETE /entity_type - удалить схему сущности. Лишает слой возможности добавлять атрибуты и пр.

Параметры:
{
    "layer": "Название_слоя"
}

Ответ: 200 Ок

GET /entity_types - вернуть список всех слоёв, у которых есть схемы, т.е. возможность атрибутивного описания.

Ответ:

```json
[
    {"layer": "название_слоя", "name" : "Название_типа сущности"},
    {"layer": "название_слоя", "name" : "Название_типа сущности"},
    ...
]
```
